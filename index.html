<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>æ—¥æœ¬åœ°å›³ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†</title>

<style>
body{
    margin:0;
    font-family:sans-serif;
    background:#f5f5f5;
}

h3{
    text-align:center;
    margin:10px 0;
}

#map-wrapper{
    width:100%;
    height:75vh;
}

#map-wrapper svg{
    width:100%;
    height:100%;
}

.prefecture{
    fill:#ffffff;
    stroke:#333;
    stroke-width:0.5;
}

.selected{
    fill:#e60012 !important;
}

.pref-label{
    font-size:12px;
    text-anchor:middle;
    pointer-events:none;
    fill:#000;
}

#resetBtn{
    display:block;
    margin:20px auto;
    padding:12px 25px;
    font-size:16px;
    border:none;
    background:#333;
    color:#fff;
    border-radius:20px;
}
</style>
</head>

<body>

<h3>ã„ã‹ã®ãŠã™ã—</h3>
<div id="map-wrapper"></div>
<button id="resetBtn">ã™ã¹ã¦è§£é™¤</button>

<script>
const isMobile = /iPhone|Android.+Mobile/.test(navigator.userAgent)
const mapFile = isMobile ? "./map-mobile.svg" : "./map-full.svg"

let isPinching = false

fetch(mapFile)
.then(res => res.text())
.then(svgData => {

    document.getElementById("map-wrapper").innerHTML = svgData

    const svg = document.querySelector("svg")

    // viewBoxè£œæ­£
    if (!svg.getAttribute("viewBox")) {
        const bbox = svg.getBBox()
        svg.setAttribute("viewBox", `0 0 ${bbox.width} ${bbox.height}`)
    }

    // ğŸ”¥ SVGå†…éƒ¨ã§å·¦å³åè»¢
    const width = svg.viewBox.baseVal.width
    const height = svg.viewBox.baseVal.height

    const g = document.createElementNS("http://www.w3.org/2000/svg","g")
    g.setAttribute("transform", `translate(${width},0) scale(-1,1)`)

    while(svg.firstChild){
        g.appendChild(svg.firstChild)
    }
    svg.appendChild(g)

    const prefs = document.querySelectorAll('.prefecture')

    // ãƒ”ãƒ³ãƒåˆ¤å®š
    document.addEventListener("touchstart", e=>{
        if(e.touches.length>1) isPinching=true
    })

    document.addEventListener("touchend", e=>{
        if(e.touches.length<2){
            setTimeout(()=>isPinching=false,100)
        }
    })

    prefs.forEach(pref=>{

        pref.addEventListener("touchend",function(){
            if(isPinching) return
            this.classList.toggle("selected")
        })

        pref.addEventListener("click",function(){
            this.classList.toggle("selected")
        })

        // çœŒåè¡¨ç¤ºï¼ˆdata-nameãŒã‚ã‚‹å ´åˆï¼‰
        if(pref.dataset.name){
            const bbox = pref.getBBox()
            const label = document.createElementNS("http://www.w3.org/2000/svg","text")

            label.setAttribute("x",bbox.x + bbox.width/2)
            label.setAttribute("y",bbox.y + bbox.height/2)
            label.setAttribute("class","pref-label")
            label.textContent = pref.dataset.name

            g.appendChild(label)
        }
    })

    document.getElementById("resetBtn").addEventListener("click",()=>{
        prefs.forEach(p=>p.classList.remove("selected"))
    })

})
</script>

</body>
</html>
